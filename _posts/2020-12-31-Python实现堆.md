---
layout:     post   				    
title:      Python实现堆 				
subtitle:    
date:       2020-12-31 				
author:     WarmStar 						
header-img: img/blog10.jpg 	
catalog: true 				
tags:							
    - Python
---

### 最小的k个数

[LeetCode原问题](https://leetcode-cn.com/problems/zui-xiao-de-kge-shu-lcof/)  输入一个无序的整数数组`arr`，找出其中最小的`k`个数。

##### 排序

最简单的做法就是直接排序，然后取出前`k`个元素即可：

```python
def min_k(arr, k):
    arr.sort()
    return arr[:k]
```

这里的`sort()`方法其实是`timsort`，是`合并排序(merge sort)`和`插入排序(insertion sort)`相结合得到的排序算法，有非常优秀的应用效率。这样做的时间复杂度为`O(NlogN)`，`N`为数组长度。但对于该问题，有更好的解决方法，例如快速排序和堆排序。

<br/>

### 堆结构

##### 简介

+ 堆是一种特殊的树形数据结构，每个节点都有一个值，通常所说的堆数据结构指的是二叉树。
+ 堆的特点是根节点的值最大(或最小)，且根节点的两个孩子结点也能与其孩子节点组成子树。
+ 堆分为两种，大根堆(小根堆)是一棵每一个节点的键值都不小于(大于)其孩子节点键值的树，但不是严格排序。无论是大根堆还是小根堆(前提是二叉堆)都可以看成是一颗完全二叉树。
+ Python只实现了默认的小根堆。

直接导入`heapq`库即可使用小根堆，`heappush`方法是往堆内加入新元素：

```python
import heapq

data = [12, 8, 10, 4, 6, 7, 9]

heap1 = []
for i in data:
    heapq.heappush(heap1, i)
print(heap1)

data.sort()
heap2 = []
for i in data:
    heapq.heappush(heap2, i)
print(heap2)
---------------------------------------------------------------------
> [4, 6, 7, 12, 8, 10, 9]
> [4, 6, 7, 8, 9, 10, 12]
```

由打印结果可以看出，堆内数据并不是严格排序的。两个结果的根结点都是4，区别在于第二层结点6和7对应的孩子结点不同。

除了`heappush`可以将元素添加到堆之外，也可以直接使用`heapify`将列表转化为堆，下面列举常用的几个方法:

```python
data = [12, 8, 10, 4, 6, 7, 9]
heapq.heapify(data)  # 将列表转化为堆
print(data)
print(heapq.nsmallest(4, data))  # 返回堆中最小的n个元素
print(heapq.nlargest(4, data))  # 返回堆中最大的n个元素
heapq.heappop(data)  # 弹出堆顶元素
print(data)
---------------------------------------------------------------------
> [4, 6, 7, 8, 12, 10, 9]
> [4, 6, 7, 8]
> [12, 10, 9, 8]
> [6, 8, 7, 9, 12, 10]
```



##### 堆排序

```python
def min_k(arr, k):
    heap = [-x for x in arr[:k]]
    heapq.heapify(heap)
    for i in range(k, len(arr)):
        if -heap[0] > arr[i]:
            heapq.heappop(heap)
            heapq.heappush(heap, -arr[i])
    return [-x for x in heap]

data = [4, 5, 1, 6, 2, 7, 3, 8]
min_k(data, 4)
---------------------------------------------------------------------
> [4, 3, 1, 2]
```

