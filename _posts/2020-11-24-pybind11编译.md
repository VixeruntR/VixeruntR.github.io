---
layout:     post   				    
title:      Python调用C++				
subtitle:   基于pybind11实现Python调用C++编写的算法(Linux+Cmake)
date:       2020-11-24 				
author:     WarmStar 						
header-img: img/blog5.jpg	
catalog: true 				
tags:							
    - DL
---

#### 基于pybind11实现Python调用c++编写的算法(Linux+Cmake)

1. ##### 下载pybind11

   `git clone https://github.com/pybind/pybind11.git`

   ![Markdown](http://i2.tiimg.com/730017/26c208452061516f.png)

   

2. ##### 安装pytest

   `pip install pytest`

3. ##### 编译安装

   ```python
   cd pybind11
   mkdir build
   cd build
   cmake ..
   cmake --build . --config Release --target check
   ```

   ![Markdown](http://i2.tiimg.com/730017/23a6dddce289ffa2.png)

![Markdown](http://i2.tiimg.com/730017/2ee6dceaac7477ca.png)

![Markdown](http://i2.tiimg.com/730017/fcf236e44b9211e3.png)



4. ##### 最简单的代码编译方式

   在Linux上编译，可以选择最简单的gcc方式。`example.cpp`是`c++`代码文件。

   ```
   c++ -O3 -Wall -shared -std=c++11 -fPIC `python3 -m pybind11 --includes` example.cpp -o example`python3-config --extension-suffix`
   ```

   

5. ##### 使用Cmake进行编译

   使用 cmake 创建工程，编译为动态库，然后使用 python 调用。

   5.1   首先需要写一个CMakeLists.txt。其中`example.cpp`是`c++`文件。

   ![Markdown](http://i2.tiimg.com/730017/48aa609ab5a80670.png)

   5.2   这里要求`example.cpp`和`pybind11`放在同级的目录下，因为在`CMakeLists.txt`中调用了	    同目录的`pybind11`和`example.cpp`文件。

   ![](D:/百度网盘/DownLoad/demo/images/6.png)

   ​		然后直接在当前目录下执行:

   ```python
   cmake .
   make
   ```

   ![Markdown](http://i2.tiimg.com/730017/3654b2cec4e45bc8.png)

   5.3  最终生成如下`.so`文件，该文件可以重命名，例如改成`example.so`。

   ![Markdown](http://i2.tiimg.com/730017/02973b93887f60b3.png)

   5.4  至此可以使用python直接调用`example.so`。

   ![Markdown](http://i2.tiimg.com/730017/855c810adf707d19.png)

   5.5 注意`c++`文件`PYBIND11_MODULE`这里变量名要和`c++`文件同名：

   ![Markdown](http://i2.tiimg.com/730017/5e7cee5510ae8693.png)

   

